# Changelog

## v1.2.3

### 📦 数据导入导出

- 后台设置页新增数据导出功能，支持导出文章、评论、标签、导航等数据为 JSON
- 可选导出媒体记录、用户信息、站点设置
- 新增数据导入功能，支持从 JSON 备份文件恢复数据
- 新实例部署时支持从备份初始化：选择导入用户并设置新密码，一键恢复所有数据

## v1.2.2

### 📊 Umami 统计集成

- 支持 Umami Cloud 和自建实例两种模式
- 后台设置页面可配置启用/禁用、Website ID、API 凭证
- Umami Cloud 模式下脚本通过服务端代理加载，避免广告拦截
- Dashboard 新增流量图表，显示最近 7 天的统计数据：
  - 当前在线访客数
  - 页面浏览量 (PV)、访客数、访问数
  - 跳出率、平均访问时长
  - 每日 PV/访客趋势图

### 📦 数据库变更

- `settings` 表新增 Umami 相关字段

## v1.2.1

### 🚀 性能优化

**Redis 缓存支持**
- 新增可选 Redis 缓存层，设置 `REDIS_URL` 启用
- 缓存覆盖：Settings、Navigation、Tags、Posts、Sitemap、RSS Feed
- 未配置 Redis 时自动回退到 Next.js 内存缓存

### 🤖 AI 垃圾评论检测

- 支持 OpenAI 兼容 API 自动检测垃圾评论
- 评分逻辑：低分自动通过，中分待审核，高分自动拒绝
- 新增邮箱白名单功能，白名单用户评论自动通过
- 审核时可一键"通过并加入白名单"

## v1.2.0

### 🚀 性能优化

**缓存层**
- 新增 Next.js unstable_cache 缓存层，减少数据库查询
- Settings、Navigation、Tags、Posts 数据支持缓存
- 基于 tag 的缓存失效机制，数据更新时自动刷新

**数据库连接池**
- 优化连接池配置，支持 DB_POOL_MAX/DB_POOL_MIN 环境变量
- 合理的超时设置，防止 Serverless 环境连接泄漏

### 🔒 安全增强

**敏感数据加密**
- S3 密钥、Resend API Key 等敏感配置使用 AES-256-GCM 加密存储
- 支持自定义 ENCRYPTION_KEY 或从 BETTER_AUTH_SECRET 自动派生
- 向后兼容未加密的旧数据

### 🔍 SEO 优化

- 新增 `/robots.txt` 搜索引擎爬虫规则
- 新增 `/sitemap.xml` 动态站点地图（含缓存）
- 文章页增强 metadata：OpenGraph、Twitter Card、keywords
- 新增 JSON-LD 结构化数据（Schema.org Article）

### ✨ 新功能

**全局搜索**
- 博客头部新增搜索按钮
- 支持 Cmd+K / Ctrl+K 快捷键打开搜索
- 实时搜索文章标题和内容，键盘导航支持

**媒体管理增强**
- Markdown 编辑器新增"媒体库"按钮
- 可从已上传图片中选择插入，无需重复上传

**评论系统增强**
- 访客评论新增算术验证码，防止垃圾评论
- 新评论自动邮件通知管理员（需配置 Resend）

## v1.1.3

### 🔒 安全增强

- 启用 better-auth 内置 Rate Limiting
  - 全局限制：60秒内最多100次请求
  - 登录限制：60秒内最多5次尝试
  - 注册限制：60秒内最多3次尝试
  - 使用数据库存储，支持 serverless 环境

### ✨ 新功能

- Admin 内容管理添加搜索功能，支持按标题和内容搜索

### 🎨 UI 改进

- Admin 文章和评论列表支持响应式设计，移动端显示卡片视图

### 📦 数据库变更

- 新增 `rateLimit` 表用于存储限流数据

## v1.1.2

### 🔒 安全修复

- Admin 后台添加角色验证，非管理员用户无法访问
- 所有删除操作添加二次确认对话框，防止误操作

### ✨ 新功能

- 标签支持编辑（重命名）功能
- Admin Posts 和 Comments 列表支持分页
- 操作反馈 Toast 提示（成功/失败）

### 🐛 Bug 修复

- 删除文章时级联清理评论和标签关联数据

### 🔧 改进

- Blog 公开页面支持暗色模式
- 新增通用删除确认组件 DeleteButton
- 重构 Posts/Comments 表格为客户端组件

### 📦 依赖更新

- 新增 sonner (Toast 通知)

## v1.1.1

### ✨ 新功能

- 添加 ASBP 图标

### 🔧 改进

- 修复移动界面显示错误

## v1.1.0

### ✨ 新功能

**评论系统增强**
- 支持嵌套回复：访客和用户可以回复特定评论，形成对话式讨论
- 访客网站字段：评论者可以留下个人网站链接
- Gravatar 头像：根据访客邮箱自动显示 Gravatar 头像

**Passkey 无密码登录**
- 支持 WebAuthn/Passkey 认证，可使用指纹、面容或安全密钥登录
- 管理后台新增 Passkey 管理页面，支持添加和删除设备
- 显示设备类型和备份状态

**密码管理**
- 新增修改密码功能，支持在后台更新账户密码
- 密码可见性切换

**媒体存储增强**
- S3 CDN 域名支持：可配置自定义域名加速媒体访问
- 发件人邮箱配置：可自定义评论通知的发件人地址

**国际化 (i18n)**
- 完整的中英文双语支持
- 基于 next-intl 的国际化架构

### 🔧 改进

- 评论区 UI 重构，更现代的交互体验
- 随记页面支持管理员快速发布和编辑
- 用户管理页面支持编辑头像、简介和个人链接

### 📦 依赖更新

- Next.js 16.0.10
- React 19.2.1
- better-auth 1.4.6 (含 @better-auth/passkey)
- next-intl 4.5.8
